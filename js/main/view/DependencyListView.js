/// <amd-dependency path="text!../template/dependencylist.html" />
/// <amd-dependency path="text!../template/dependencylist-item.html" />
/// <amd-dependency path="bootstrap" />
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
define(["require", "exports", "backbone", "handlebars", "clipboard", "text!../template/dependencylist.html", "text!../template/dependencylist-item.html", "bootstrap"], function (require, exports, Backbone, Handlebars, Clipboard) {
    var itemTemplate = Handlebars.compile(require("text!../template/dependencylist-item.html"));
    var template = Handlebars.compile(require("text!../template/dependencylist.html"));
    var DependencyListView = (function (_super) {
        __extends(DependencyListView, _super);
        function DependencyListView(model) {
            _super.call(this, { model: model });
            this.template = template;
            model.on("change:dirty", this.toggleDisabled.bind(this));
        }
        DependencyListView.prototype.events = function () {
            return {
                "click .btn-reset": "resetVersions",
                "click .btn-view-packagejson": "viewPackageJson",
                "click #dlg-package-json .btn-close": "hidePackageJson"
            };
        };
        DependencyListView.prototype.resetVersions = function () {
            this.model.reset();
        };
        DependencyListView.prototype.dlgPackageJson = function () {
            return this.$("#dlg-package-json");
        };
        DependencyListView.prototype.viewPackageJson = function () {
            _paq.push(['trackEvent', 'User', 'ViewMyUpdateDep']);
            this.dlgPackageJson().modal();
            this.dlgPackageJson().find("textarea").val(this.model.formattedPackageJson);
            new Clipboard("#dlg-package-json .btn-clipboard");
        };
        DependencyListView.prototype.hidePackageJson = function () {
            this.dlgPackageJson().modal("hide");
        };
        DependencyListView.prototype.toggleDisabled = function (model) {
            if (model.dirty) {
                this.$(".btn-view-packagejson").removeClass("disabled");
            }
            else {
                this.$(".btn-view-packagejson").addClass("disabled");
            }
        };
        DependencyListView.prototype.render = function () {
            this.$el.html(this.template({
                project: this.model
            }));
            var $listGroup = this.$el.find(".list-group");
            this.model.dependencies.each(function (dep) { return new DependencyView(dep).render().$el.appendTo($listGroup); });
            this.toggleDisabled(this.model);
            return this;
        };
        return DependencyListView;
    })(Backbone.View);
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.default = DependencyListView;
    var DependencyView = (function (_super) {
        __extends(DependencyView, _super);
        function DependencyView(model) {
            _super.call(this, {
                model: model,
                tagName: "span",
                className: "list-group-item"
            });
            this.template = itemTemplate;
            this.opened = false;
            this.popover = false;
            this.tooltip = false;
            this.listenTo(this.model, "change", this.render);
        }
        DependencyView.prototype.events = function () {
            return {
                "change select": "changeCurrentVersion",
                "click .cnt-versionlist li": "changeCurrentVersion",
                "click": "toggleVersionList",
            };
        };
        DependencyView.prototype.toggleVersionList = function () {
            if (this.model.isObsolete) {
                if (this.opened) {
                    this.$(".cnt-versionlist").hide();
                }
                else {
                    this.$(".cnt-versionlist").show();
                }
                this.opened = !this.opened;
            }
        };
        DependencyView.prototype.setupPopover = function () {
            if (this.tooltip) {
                this.$el.tooltip("destroy");
                this.tooltip = false;
            }
            this.$el.attr({
                "data-toggle": "popover",
                "data-trigger": "hover",
                "data-content": "Click to select newer version",
                "data-placement": "top"
            });
            this.$el.popover();
            this.popover = true;
        };
        DependencyView.prototype.setupTooltip = function () {
            if (this.popover) {
                this.$el.popover("destroy");
                this.popover = false;
            }
            if (this.tooltip) {
                this.$el.tooltip("destroy");
            }
            this.$el.tooltip({
                html: true,
                placement: "top",
                animation: false,
                title: "You chose to upgrade to <span class='txt-hover-ok'>" + this.model.currentVersion.versionString + "</span>"
            });
            this.tooltip = true;
        };
        DependencyView.prototype.changeCurrentVersion = function (event) {
            this.opened = false;
            this.model.setCurrentVersion($(event.target).attr("value"));
            event.stopPropagation();
        };
        DependencyView.prototype.render = function (model) {
            if (model === void 0) { model = this.model; }
            this.$el.html(this.template(model));
            this.$(".lbl-dirty").css("visibility", this.model.dirty ? "visible" : "hidden");
            if (this.model.dirty) {
                this.$el.popover("destroy");
                this.setupTooltip();
            }
            else if (this.model.isObsolete) {
                this.$el.tooltip("destroy");
                this.setupPopover();
            }
            return this;
        };
        return DependencyView;
    })(Backbone.View);
    exports.DependencyView = DependencyView;
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4vdmlldy9EZXBlbmRlbmN5TGlzdFZpZXcudHMiXSwibmFtZXMiOlsiRGVwZW5kZW5jeUxpc3RWaWV3IiwiRGVwZW5kZW5jeUxpc3RWaWV3LmNvbnN0cnVjdG9yIiwiRGVwZW5kZW5jeUxpc3RWaWV3LmV2ZW50cyIsIkRlcGVuZGVuY3lMaXN0Vmlldy5yZXNldFZlcnNpb25zIiwiRGVwZW5kZW5jeUxpc3RWaWV3LmRsZ1BhY2thZ2VKc29uIiwiRGVwZW5kZW5jeUxpc3RWaWV3LnZpZXdQYWNrYWdlSnNvbiIsIkRlcGVuZGVuY3lMaXN0Vmlldy5oaWRlUGFja2FnZUpzb24iLCJEZXBlbmRlbmN5TGlzdFZpZXcudG9nZ2xlRGlzYWJsZWQiLCJEZXBlbmRlbmN5TGlzdFZpZXcucmVuZGVyIiwiRGVwZW5kZW5jeVZpZXciLCJEZXBlbmRlbmN5Vmlldy5jb25zdHJ1Y3RvciIsIkRlcGVuZGVuY3lWaWV3LmV2ZW50cyIsIkRlcGVuZGVuY3lWaWV3LnRvZ2dsZVZlcnNpb25MaXN0IiwiRGVwZW5kZW5jeVZpZXcuc2V0dXBQb3BvdmVyIiwiRGVwZW5kZW5jeVZpZXcuc2V0dXBUb29sdGlwIiwiRGVwZW5kZW5jeVZpZXcuY2hhbmdlQ3VycmVudFZlcnNpb24iLCJEZXBlbmRlbmN5Vmlldy5yZW5kZXIiXSwibWFwcGluZ3MiOiJBQUFBLGtFQUFrRTtBQUNsRSx1RUFBdUU7QUFDdkUsdUNBQXVDOzs7Ozs7O0lBUXZDLElBQU0sWUFBWSxHQUFHLFVBQVUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLDJDQUEyQyxDQUFDLENBQUMsQ0FBQztJQUU5RixJQUFNLFFBQVEsR0FBRyxVQUFVLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDLENBQUM7SUFJckY7UUFBZ0RBLHNDQUEyQkE7UUErQnpFQSw0QkFBWUEsS0FBbUJBO1lBQzdCQyxrQkFBTUEsRUFBQ0EsS0FBS0EsRUFBRUEsS0FBS0EsRUFBQ0EsQ0FBQ0EsQ0FBQ0E7WUE5QmhCQSxhQUFR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Q0FBQ0E7Z0JBQ3JCQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxPQUFPQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQTtnQkFDNUJBLElBQUlBLENBQUNBLFlBQVlBLEVBQUVBLENBQUNBO1lBQ3RCQSxDQUFDQTtZQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDakNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLE9BQU9BLENBQUNBLFNBQVNBLENBQUNBLENBQUNBO2dCQUM1QkEsSUFBSUEsQ0FBQ0EsWUFBWUEsRUFBRUEsQ0FBQ0E7WUFDdEJBLENBQUNBO1lBQ0RBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBO1FBQ2RBLENBQUNBO1FBRUhQLHFCQUFDQTtJQUFEQSxDQXpGQSxBQXlGQ0EsRUF6Rm1DLFFBQVEsQ0FBQyxJQUFJLEVBeUZoRDtJQXpGWSxzQkFBYyxpQkF5RjFCLENBQUEiLCJmaWxlIjoibWFpbi92aWV3L0RlcGVuZGVuY3lMaXN0Vmlldy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vLyA8YW1kLWRlcGVuZGVuY3kgcGF0aD1cInRleHQhLi4vdGVtcGxhdGUvZGVwZW5kZW5jeWxpc3QuaHRtbFwiIC8+XG4vLy8gPGFtZC1kZXBlbmRlbmN5IHBhdGg9XCJ0ZXh0IS4uL3RlbXBsYXRlL2RlcGVuZGVuY3lsaXN0LWl0ZW0uaHRtbFwiIC8+XG4vLy8gPGFtZC1kZXBlbmRlbmN5IHBhdGg9XCJib290c3RyYXBcIiAvPlxuXG5pbXBvcnQgQmFja2JvbmUgPSByZXF1aXJlKFwiYmFja2JvbmVcIik7XG5pbXBvcnQgUHJvamVjdE1vZGVsIGZyb20gXCIuLi9tb2RlbC9Qcm9qZWN0TW9kZWxcIjtcbmltcG9ydCBEZXBlbmRlbmN5TW9kZWwgZnJvbSBcIi4uL21vZGVsL0RlcGVuZGVuY3lNb2RlbFwiO1xuaW1wb3J0IEhhbmRsZWJhcnMgPSByZXF1aXJlKFwiaGFuZGxlYmFyc1wiKTtcbmltcG9ydCBDbGlwYm9hcmQgPSByZXF1aXJlKFwiY2xpcGJvYXJkXCIpO1xuXG5jb25zdCBpdGVtVGVtcGxhdGUgPSBIYW5kbGViYXJzLmNvbXBpbGUocmVxdWlyZShcInRleHQhLi4vdGVtcGxhdGUvZGVwZW5kZW5jeWxpc3QtaXRlbS5odG1sXCIpKTtcblxuY29uc3QgdGVtcGxhdGUgPSBIYW5kbGViYXJzLmNvbXBpbGUocmVxdWlyZShcInRleHQhLi4vdGVtcGxhdGUvZGVwZW5kZW5jeWxpc3QuaHRtbFwiKSk7XG5cbmRlY2xhcmUgdmFyIF9wYXE6IGFueVtdO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBEZXBlbmRlbmN5TGlzdFZpZXcgZXh0ZW5kcyBCYWNrYm9uZS5WaWV3PFByb2plY3RNb2RlbD4ge1xuXG4gIHByaXZhdGUgdGVtcGxhdGUgPSB0ZW1wbGF0ZTtcblxuICBwdWJsaWMgZXZlbnRzKCkge1xuICAgIHJldHVybiB7XG4gICAgICBcImNsaWNrIC5idG4tcmVzZXRcIjogXCJyZXNldFZlcnNpb25zXCIsXG4gICAgICBcImNsaWNrIC5idG4tdmlldy1wYWNrYWdlanNvblwiOiBcInZpZXdQYWNrYWdlSnNvblwiLFxuICAgICAgXCJjbGljayAjZGxnLXBhY2thZ2UtanNvbiAuYnRuLWNsb3NlXCI6IFwiaGlkZVBhY2thZ2VKc29uXCJcbiAgICB9O1xuICB9XG5cbiAgcHVibGljIHJlc2V0VmVyc2lvbnMoKSB7XG4gICAgdGhpcy5tb2RlbC5yZXNldCgpO1xuICB9XG5cbiAgcHVibGljIGRsZ1BhY2thZ2VKc29uKCk6IEpRdWVyeSB7XG4gICAgcmV0dXJuIHRoaXMuJChcIiNkbGctcGFja2FnZS1qc29uXCIpO1xuICB9XG5cbiAgcHVibGljIHZpZXdQYWNrYWdlSnNvbigpIHtcbiAgICBfcGFxLnB1c2goWyd0cmFja0V2ZW50JywgJ1VzZXInLCAnVmlld015VXBkYXRlRGVwJ10pO1xuICAgIHRoaXMuZGxnUGFja2FnZUpzb24oKS5tb2RhbCgpO1xuICAgIHRoaXMuZGxnUGFja2FnZUpzb24oKS5maW5kKFwidGV4dGFyZWFcIikudmFsKHRoaXMubW9kZWwuZm9ybWF0dGVkUGFja2FnZUpzb24pO1xuICAgIG5ldyBDbGlwYm9hcmQoXCIjZGxnLXBhY2thZ2UtanNvbiAuYnRuLWNsaXBib2FyZFwiKTtcbiAgfVxuXG4gIHB1YmxpYyBoaWRlUGFja2FnZUpzb24oKSB7XG4gICAgdGhpcy5kbGdQYWNrYWdlSnNvbigpLm1vZGFsKFwiaGlkZVwiKTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKG1vZGVsOiBQcm9qZWN0TW9kZWwpIHtcbiAgICBzdXBlcih7bW9kZWw6IG1vZGVsfSk7XG4gICAgbW9kZWwub24oXCJjaGFuZ2U6ZGlydHlcIiwgdGhpcy50b2dnbGVEaXNhYmxlZC5iaW5kKHRoaXMpKTtcbiAgfVxuXG4gIHRvZ2dsZURpc2FibGVkKG1vZGVsOiBQcm9qZWN0TW9kZWwpIHtcbiAgICBpZiAobW9kZWwuZGlydHkpIHtcbiAgICAgIHRoaXMuJChcIi5idG4tdmlldy1wYWNrYWdlanNvblwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLiQoXCIuYnRuLXZpZXctcGFja2FnZWpzb25cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICB9XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgdGhpcy4kZWwuaHRtbCh0aGlzLnRlbXBsYXRlKHtcbiAgICAgIHByb2plY3Q6IHRoaXMubW9kZWxcbiAgICB9KSk7XG4gICAgdmFyICRsaXN0R3JvdXAgPSB0aGlzLiRlbC5maW5kKFwiLmxpc3QtZ3JvdXBcIik7XG4gICAgdGhpcy5tb2RlbC5kZXBlbmRlbmNpZXMuZWFjaChkZXAgPT4gbmV3IERlcGVuZGVuY3lWaWV3KGRlcCkucmVuZGVyKCkuJGVsLmFwcGVuZFRvKCRsaXN0R3JvdXApKTtcbiAgICB0aGlzLnRvZ2dsZURpc2FibGVkKHRoaXMubW9kZWwpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbn1cblxuZXhwb3J0IGNsYXNzIERlcGVuZGVuY3lWaWV3IGV4dGVuZHMgQmFja2JvbmUuVmlldzxEZXBlbmRlbmN5TW9kZWw+IHtcblxuICBwcml2YXRlIHRlbXBsYXRlID0gaXRlbVRlbXBsYXRlO1xuXG4gIHByaXZhdGUgb3BlbmVkOiBib29sZWFuID0gZmFsc2U7XG5cbiAgcHJpdmF0ZSBwb3BvdmVyOiBib29sZWFuID0gZmFsc2U7XG5cbiAgcHJpdmF0ZSB0b29sdGlwOiBib29sZWFuID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IobW9kZWw6IERlcGVuZGVuY3lNb2RlbCkge1xuICAgIHN1cGVyKHtcbiAgICAgIG1vZGVsOiBtb2RlbCxcbiAgICAgIHRhZ05hbWU6IFwic3BhblwiLFxuICAgICAgY2xhc3NOYW1lOiBcImxpc3QtZ3JvdXAtaXRlbVwiXG4gICAgfSk7XG4gICAgdGhpcy5saXN0ZW5Ubyh0aGlzLm1vZGVsLCBcImNoYW5nZVwiLCB0aGlzLnJlbmRlcik7XG4gIH1cblxuICBldmVudHMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIFwiY2hhbmdlIHNlbGVjdFwiOiBcImNoYW5nZUN1cnJlbnRWZXJzaW9uXCIsXG4gICAgICBcImNsaWNrIC5jbnQtdmVyc2lvbmxpc3QgbGlcIjogXCJjaGFuZ2VDdXJyZW50VmVyc2lvblwiLFxuICAgICAgXCJjbGlja1wiOiBcInRvZ2dsZVZlcnNpb25MaXN0XCIsXG4gICAgfTtcbiAgfVxuXG4gIHRvZ2dsZVZlcnNpb25MaXN0KCkge1xuICAgIGlmICh0aGlzLm1vZGVsLmlzT2Jzb2xldGUpIHtcbiAgICAgIGlmICh0aGlzLm9wZW5lZCkge1xuICAgICAgICB0aGlzLiQoXCIuY250LXZlcnNpb25saXN0XCIpLmhpZGUoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuJChcIi5jbnQtdmVyc2lvbmxpc3RcIikuc2hvdygpO1xuICAgICAgfVxuICAgICAgdGhpcy5vcGVuZWQgPSAhdGhpcy5vcGVuZWQ7XG4gICAgfVxuICB9XG5cbiAgc2V0dXBQb3BvdmVyKCkge1xuICAgIGlmICh0aGlzLnRvb2x0aXApIHtcbiAgICAgIHRoaXMuJGVsLnRvb2x0aXAoXCJkZXN0cm95XCIpO1xuICAgICAgdGhpcy50b29sdGlwID0gZmFsc2U7XG4gICAgfVxuICAgIHRoaXMuJGVsLmF0dHIoe1xuICAgICAgXCJkYXRhLXRvZ2dsZVwiOiBcInBvcG92ZXJcIixcbiAgICAgIFwiZGF0YS10cmlnZ2VyXCI6IFwiaG92ZXJcIixcbiAgICAgIFwiZGF0YS1jb250ZW50XCI6IFwiQ2xpY2sgdG8gc2VsZWN0IG5ld2VyIHZlcnNpb25cIixcbiAgICAgIFwiZGF0YS1wbGFjZW1lbnRcIjogXCJ0b3BcIlxuICAgIH0pO1xuICAgIHRoaXMuJGVsLnBvcG92ZXIoKTtcbiAgICB0aGlzLnBvcG92ZXIgPSB0cnVlO1xuICB9XG5cbiAgc2V0dXBUb29sdGlwKCkge1xuICAgIGlmICh0aGlzLnBvcG92ZXIpIHtcbiAgICAgIHRoaXMuJGVsLnBvcG92ZXIoXCJkZXN0cm95XCIpO1xuICAgICAgdGhpcy5wb3BvdmVyID0gZmFsc2U7XG4gICAgfVxuICAgIGlmICh0aGlzLnRvb2x0aXApIHtcbiAgICAgIHRoaXMuJGVsLnRvb2x0aXAoXCJkZXN0cm95XCIpO1xuICAgIH1cbiAgICB0aGlzLiRlbC50b29sdGlwKHtcbiAgICAgIGh0bWw6IHRydWUsXG4gICAgICBwbGFjZW1lbnQ6IFwidG9wXCIsXG4gICAgICBhbmltYXRpb246IGZhbHNlLFxuICAgICAgdGl0bGU6IFwiWW91IGNob3NlIHRvIHVwZ3JhZGUgdG8gPHNwYW4gY2xhc3M9J3R4dC1ob3Zlci1vayc+XCIgKyB0aGlzLm1vZGVsLmN1cnJlbnRWZXJzaW9uLnZlcnNpb25TdHJpbmcgKyBcIjwvc3Bhbj5cIlxuICAgIH0pO1xuICAgIHRoaXMudG9vbHRpcCA9IHRydWU7XG4gIH1cblxuICBjaGFuZ2VDdXJyZW50VmVyc2lvbihldmVudDogSlF1ZXJ5RXZlbnRPYmplY3QpIHtcbiAgICB0aGlzLm9wZW5lZCA9IGZhbHNlO1xuICAgIHRoaXMubW9kZWwuc2V0Q3VycmVudFZlcnNpb24oJChldmVudC50YXJnZXQpLmF0dHIoXCJ2YWx1ZVwiKSk7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gIH1cblxuICByZW5kZXIobW9kZWw6IERlcGVuZGVuY3lNb2RlbCA9IHRoaXMubW9kZWwpIHtcbiAgICB0aGlzLiRlbC5odG1sKHRoaXMudGVtcGxhdGUobW9kZWwpKTtcbiAgICB0aGlzLiQoXCIubGJsLWRpcnR5XCIpLmNzcyhcInZpc2liaWxpdHlcIiwgdGhpcy5tb2RlbC5kaXJ0eSA/IFwidmlzaWJsZVwiIDogXCJoaWRkZW5cIik7XG4gICAgaWYgKHRoaXMubW9kZWwuZGlydHkpIHtcbiAgICAgIHRoaXMuJGVsLnBvcG92ZXIoXCJkZXN0cm95XCIpO1xuICAgICAgdGhpcy5zZXR1cFRvb2x0aXAoKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMubW9kZWwuaXNPYnNvbGV0ZSkge1xuICAgICAgdGhpcy4kZWwudG9vbHRpcChcImRlc3Ryb3lcIik7XG4gICAgICB0aGlzLnNldHVwUG9wb3ZlcigpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
